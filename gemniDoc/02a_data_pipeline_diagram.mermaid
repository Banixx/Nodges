sequenceDiagram
    participant User
    participant UIManager
    participant NodgesApp
    participant FutureDataParser
    participant LayoutManager
    participant NodeObjects
    participant Edge
    participant Scene

    User->>UIManager: Klickt auf "Load File"-Button
    UIManager->>NodgesApp: ruft `loadData(url)` auf
    
    NodgesApp->>NodgesApp: `fetch(url)`
    Note right of NodgesApp: Lädt die JSON-Datei
    
    NodgesApp->>NodgesApp: `clearScene()`
    Note right of NodgesApp: Entfernt alte 3D-Objekte

    %% --- Daten-Normalisierung ---
    alt Zukunftsformat? (data.data.entities)
        NodgesApp->>FutureDataParser: `parseData(data)`
        FutureDataParser-->>NodgesApp: Gibt `{entities, relationships}` zurück
        NodgesApp->>NodgesApp: Transformiert zu `currentNodes` / `currentEdges`
    else Standardformat
        NodgesApp->>NodgesApp: Weist `data.nodes` & `data.edges` zu `currentNodes` / `currentEdges` zu
        Note over NodgesApp: Normalisiert Kanten (source/target -> start/end)
    end

    %% --- Layout-Berechnung ---
    opt Knoten haben keine Position
        NodgesApp->>LayoutManager: `applyLayout('force-directed', ...)`
        LayoutManager-->>NodgesApp: Aktualisiert x, y, z in `currentNodes`
    end

    %% --- Objekt-Erstellung ---
    NodgesApp->>NodgesApp: `createNodes()`
    loop für jeden Knoten in `currentNodes`
        NodgesApp->>NodeObjects: `createNodeMesh(type, options)`
        NodeObjects-->>NodgesApp: Gibt `THREE.Mesh` zurück
        NodgesApp->>Scene: `scene.add(mesh)`
    end

    NodgesApp->>NodgesApp: `createEdges()`
    loop für jede Kante in `currentEdges`
        NodgesApp->>Edge: `new Edge(start, end, options)`
        Edge-->>NodgesApp: Gibt Instanz mit `tube` (THREE.Mesh) zurück
        NodgesApp->>Scene: `scene.add(tube)`
    end

    %% --- Finale UI-Updates ---
    NodgesApp->>UIManager: `updateFileInfo(...)`
    UIManager->>User: Aktualisiert Info-Panel im HTML
